<div *ngIf="isQuizStarted" class="timer">
  <p>Time Remaining: {{ remainingTime | number: '2.0' }} seconds</p>
</div>
<section class="quiz-list" *ngIf="quizzes.length > 0">
  <div class="container mt-5">
    <h2 class="text-center mb-4">Liste des quiz</h2>

    <div class="row mb-3">
      <div class="col-12">
        <input type="text" class="form-control" placeholder="Search by quiz title" [(ngModel)]="searchTerm" />
      </div>
    </div>

    <div class="row">
      <div class="col-md-4 mb-4" *ngFor="let quiz of filteredQuizzes">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ quiz.title }}</h5>
            <p class="card-text">{{ quiz.description }}</p>
            
            <p class="card-text"><small class="text-muted">Durée : {{ quiz.duration }} minutes</small></p>
            <p class="card-text"><small class="text-muted">Nombre de questions : {{ quiz.nbrquestions }}</small></p>

            <div class="d-flex justify-content-between">
              <button *ngIf="userRole !== 'teacher'" (click)="startQuiz(quiz.quizId)" class="btn btn-primary btn-sm">
                Commencer
              </button>
              <button class="btn btn-secondary mt-3" (click)="downloadPDF(quiz)">
                Télécharger le quiz en PDF
              </button> 
              <button *ngIf="userRole === 'teacher'" (click)="navigateToUpdateQuiz(quiz.quizId)" class="btn btn-warning btn-sm">
                Modifier
              </button>
              <button *ngIf="userRole === 'teacher'" (click)="deleteQuiz(quiz.quizId)" class="btn btn-danger btn-sm">
                Supprimer
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav aria-label="Page navigation" *ngIf="totalPages > 1">
      <ul class="pagination justify-content-center">
        <li class="page-item" *ngFor="let page of [].constructor(totalPages); let i = index">
          <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
        </li>
      </ul>
    </nav>
  </div>
</section>

<section class="no-quiz" *ngIf="quizzes.length === 0 && !isLoading">
  <div class="container mt-5">
    <p class="text-center">Aucun quiz disponible pour le moment.</p>
  </div>
</section>

<div *ngIf="isLoading" class="d-flex justify-content-center mt-4">
  <div class="spinner-border text-primary" role="status">
    <span class="sr-only">Chargement...</span>
  </div>
</div>
<!-- Quiz content -->
<div *ngIf="isQuizStarted && !isQuizSubmitted" class="container mt-5" id="quiz-pdf-content">
  <h3 class="text-center">{{ selectedQuiz?.title }}</h3>
  <p class="text-center">{{ selectedQuiz?.description }}</p>

  <form>
    <div *ngFor="let question of questions">
      <div class="question">
        <p><strong>{{ question.text }}</strong></p>
       
        <img *ngIf="question.imageUrl" [src]="question.imageUrl" alt="image" style="max-width: 300px;" />
        
        <ul>
          <li *ngFor="let choice of question.choices">
            <button type="button" class="btn btn-outline-primary"
              (click)="selectAnswer(question.question_id, choice)">
              {{ choice }}
            </button>
          </li>
        </ul>
      </div>
    </div>

    <button type="button" (click)="submitQuiz()" class="btn btn-success btn-sm mt-4">Soumettre</button>
  </form>
</div>
<div id="quiz-pdf-content" style="background-color: white; padding: 20px;">
  <h3>{{ selectedQuiz?.title }}</h3>
  <p>{{ selectedQuiz?.description }}</p>
  
  <div *ngFor="let question of questions">
    <p><strong>{{ question.text }}</strong></p>
    <img *ngIf="question.imageUrl" [src]="question.imageUrl" alt="image" style="max-width: 1000px;" />
    <ul>
      <li *ngFor="let choice of question.choices">{{ choice }}</li>
    </ul>
  </div>
</div>

<!-- Display results after quiz submission -->
<div *ngIf="isQuizSubmitted" class="container mt-5">
  <h3 class="text-center">Votre score: {{ quizScore }} / {{ questions.length }}</h3>
  <div class="text-center">
    <p><strong>Résultats par question:</strong></p>
    <div *ngFor="let question of questions">
      <div class="result-item">
        <p><strong>{{ question.text }}</strong></p>
        <p>Votre réponse: {{ getAnswerForQuestion(question.question_id) }}</p>
        <p [class.text-success]="isAnswerCorrect(question)" [class.text-danger]="!isAnswerCorrect(question)">
          <strong>{{ isAnswerCorrect(question) ? 'Correct!' : 'Incorrect' }}</strong>
        </p>
      </div>
    </div>
  </div>
</div>


<div id="quiz-pdf-content" style="display: none;">
  <div *ngIf="selectedQuiz">
    <h2 style="text-align: center;">{{ selectedQuiz.title }}</h2>
    <p style="text-align: center;">{{ selectedQuiz.description }}</p>
    <p><strong>Durée :</strong> {{ selectedQuiz.duration }} minutes</p>
    <p><strong>Nombre de questions :</strong> {{ selectedQuiz.nbrquestions }}</p>

    <div *ngFor="let question of questions; let i = index" style="margin-top: 20px;">
      <p><strong>Q{{ i + 1 }} :</strong> {{ question.text }}</p>

      <img *ngIf="question.imageUrl" [src]="'http://localhost:4200' + question.imageUrl"
           alt="Image de la question"
           style="max-width: 300px; margin: 10px 0;" />

      <ul>
        <li *ngFor="let choice of question.choices">- {{ choice }}</li>
      </ul>

      <hr />
    </div>
  </div>
</div>

